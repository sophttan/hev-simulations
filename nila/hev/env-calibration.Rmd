---
title: "environmental transmission calibration"
author: "Nila Cibu"
date: "2023-04-27"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

## Defining terms

I micked the equations given on [Wikipedia](https://en.wikipedia.org/wiki/Compartmental_models_in_epidemiology#The_SEIR_model) without the birth and death rates. Let

* $N$ := total size of population
* $\beta_e$ := the "average number of contacts per person per time" except here it is simply in reference to the environmental sources
* $T$ := length of time observed from start of pandemic (in days)
* $S(t)$ := number of people in the population that are susceptible at time $t$
* $E(t)$ := number of people in the population that are exposed at time $t$
* $I(t)$ := number of people in the population that are infected at time $t$
* $I_c(t)$ := number of people in the population that are or have been infected at time $t$

I will also be using the time intervals given in the [dropbox folder](https://www.dropbox.com/home/HEV%20transmission%20modeling?preview=seir+equations.docx&preview=seir+equations.docx). Specifically, I will be operating under the assumption that after about 28 days people go from being exposed to infected and after about 7 days people go from being infected to recovered.

```{r setting values}
N = 1000
t = 365
e_t = 28 # expected time taken to become infected from exposed
i_t = 7 # expected time taken to become recovered from infected
```

## Deriving equations

From the definition of the SEIR model we have:
$$\frac{dS}{dt} = -\frac{\beta_e}{N}S$$
$$\int \frac{dS}{S} = \int -\frac{\beta_e}{N}dt$$
$$\textrm{ln}S = -\frac{\beta_e}{N}t + c$$
$$S(t) = e^{-\frac{\beta_e}{N}t+c}$$
_Remark_: $S(t) = Ne^{-\frac{\beta_e}{N}t}$ since when $S(0) = N = e^c$

From here we can then move to deriving the actual change in exposed and infected populations.

$$\frac{dE}{dt} = \frac{\beta_e}{N}S - \frac{\beta_e}{N}S(t-28)$$
$$\frac{dI}{dt} = \frac{\beta_e}{N}S(t-28) - \frac{dE(t-7)}{dt}$$
Notice that when calculating $I_c$ we don't particularly care about which people leave the inefected group, only who enters. We can then interpret $I_c$ as in integral of just this term.

$$\frac{dI_c}{dt} = \frac{\beta_e}{N}S(t-28)$$
$$I_c(t) = -Ne^{-\frac{\beta_e}{N}(t-28)}$$

## Computing calibrated values for desired cumulative values

```{r calibration}
g = function(beta){
  cum_inc = -N*exp(-beta*(t - 28)/N) + N*exp(28*beta/N) - N*p
  abs(cum_inc)
}

P = c(0.05, 0.1,0.3) # final proportion of the population that is/has been infected
beta = c(0)


for (i in 1:3) {
  p = P[i]
  beta[i] = optimise(g, c(0,100))[[1]]
}

beta
```
